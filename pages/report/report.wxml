<import src="../../components/cascaded-picker-view/cascaded-picker-view.wxml" />

<form bindsubmit="bindSubmitForm" bindreset="bindBackToIndex">
<view class="page-wrapper" bindtap="hidePicker">

  <view class="nav-wrapper">
    <view class="nav">
      <view class="region" catchtap="showPicker" hover-stop-propagation="true">
        <view class="picker">
          <text>{{nextListMap[departId].text || '请选择部门'}}</text>
          <image src="/imgs/down.png"></image>
        </view>
      </view>
    </view>
    <view class="nav">
      <view class="project">
        <picker class="picker" bindchange="bindProjectChange" value="{{proIdx}}" range="{{projectList}}" range-key="name">
          <text>{{projectList[proIdx].name}}</text>
          <image src="/imgs/down.png"></image>
        </picker>
      </view>
    </view>
    <view class="nav" wx:if="{{formData[0].length == 0}}">
      <view class="system">
        <picker class="picker" bindchange="bindSystemChange" value="{{sysIdx}}" range="{{systemList}}" range-key="name">
          <text>{{systemList[sysIdx].name}}</text>
          <image src="/imgs/down.png"></image>
        </picker>
      </view>
    </view>
  </view>
  <view class="nav-wrapper" wx:if="{{formData[0].length > 0}}">
    <view class="nav">
      <view class="system">
        <picker class="picker" bindchange="bindSystemChange" value="{{sysIdx}}" range="{{systemList}}" range-key="name">
          <text>{{systemList[sysIdx].name}}</text>
          <image src="/imgs/down.png"></image>
        </picker>
      </view>
    </view>
    <block wx:for="{{formData[0]}}" wx:for-item="item" wx:for-index="idx">
    <view class="nav">
      <view class="system">
        <picker class="picker" data-idx="{{idx}}" bindchange="bindPickerChange" value="{{item.idx}}" range="{{item.list}}" range-key="name">
          <text>{{item.list[item.idx].name}}</text>
          <image src="/imgs/down.png"></image>
        </picker>
      </view>
    </view>
    </block>
  </view>

  <view class="summary">
    <view>巡检人：{{reportInfo.realname}}</view>
    <view>巡检时间：{{reportInfo.task_time}}</view>
  </view>

  <view class="description">
    <block wx:for="{{formData[1]}}" wx:for-item="item">
      <view class="item-wrapper">
        <view class="label">{{item.title}}<text class="co-red" wx:if="{{item.leixing}}">*</text></view>
        <view class="input">
          <textarea bindinput="bindInputText" value="{{item.value}}" data-name="{{item.name}}"></textarea>
          <view bindtouchstart="bindSpeakText"
            bindtouchend="bindTouchUp" data-name="{{item.name}}"
            class="btn-speak">
            <image src="/imgs/report/icon-speak.png"></image>
          </view>
        </view>
      </view>
    </block>

    <block wx:for="{{formData[3]}}" wx:for-item="item" wx:for-index="idx">
    <view class="item-wrapper">
      <view class="label small-label">{{item.title}}</view>
      <view class="image-wrapper">
        <view class="img-upload-container">
          <view class="img-preview-container" wx:for="{{item.imageList}}" wx:for-item="src">
            <image class="img-preview" src="{{src}}" data-src="{{src}}" data-idx="{{idx}}" bindtap="previewImage"></image>
            <image class="img-close" src="/imgs/close.png" data-idx="{{idx}}" data-src="{{src}}" bindtap="delImg"></image>
          </view>
          <view class="img-preview-container"  data-idx="{{idx}}" bindtap="chooseImage">
            <image class="img-preview" src="/imgs/report/1.png" wx:if="{{imageList.length < 3}}"></image>
          </view>
        </view>
      </view>
    </view>
    </block>

    <block wx:for="{{formData[2]}}" wx:for-item="item">
      <view class="item-wrapper">
        <view class="label">{{item.title}}<text class="co-red" wx:if="{{item.leixing}}">*</text></view>
        <view class="input">
          <input type="number" bindinput="bindInputText" value="{{item.value}}" data-name="{{item.name}}"></input>
          <view bindtouchstart="bindSpeakText"
            bindtouchend="bindTouchUp" data-name="{{item.name}}"
            class="btn-speak">
            <image src="/imgs/report/icon-speak.png"></image>
          </view>
        </view>
      </view>
    </block>
  </view>

  <view class="assign">
    <view class="title">
      <view class="{{currentTab==0 ? 'active' : ''}}" bindtap="switchAssignTab" data-tab="0">
        <image src="/imgs/report/save_draft.png"></image>
        <text>推送给Ta</text>
      </view>
      <view class="{{currentTab==1 ? 'active' : ''}}" bindtap="switchAssignTab" data-tab="1">
        <image src="/imgs/report/save_draft.png"></image>
        <text>抄送给Ta</text>
      </view>
    </view>
    <scroll-view wx:if="{{currentTab==0}}" class="scroll-view-common name-pannel" scroll-y>
      <!-- <block wx:for="{{departMemberMap}}" wx:for-item="memberList" wx:for-index="did">
        <block wx:for="{{memberList}}" wx:for-item="memberObj" wx:for-index="midx">
          <view class="member-item" wx:if="{{memberObj.checked}}">
            <text>{{memberObj.realname}}</text>
            <image src="/imgs/close.png" bindtap="delMember" data-did="{{did}}" data-midx="{{midx}}"></image>
          </view>
        </block>
      </block> -->
      <block wx:for="{{memberBox1}}" wx:for-item="memberObj">
        <view class="member-item" wx:if="{{memberObj.checked}}">
          <text>{{memberObj.realname}}</text>
          <image src="/imgs/close.png" bindtap="delMember" data-midx="{{memberObj.id}}"></image>
        </view>
      </block>
    </scroll-view>
    <scroll-view wx:if="{{currentTab==1}}" class="scroll-view-common name-pannel" scroll-y>
      <!-- <block wx:for="{{departMemberMap}}" wx:for-item="memberList" wx:for-index="did">
        <block wx:for="{{memberList}}" wx:for-item="memberObj" wx:for-index="midx">
          <view class="member-item" wx:if="{{memberObj.checked1}}">
            <text>{{memberObj.realname}}</text>
            <image src="/imgs/close.png" bindtap="delMember" data-did="{{did}}" data-midx="{{midx}}"></image>
          </view>
        </block>
      </block> -->
      <block wx:for="{{memberBox2}}" wx:for-item="memberObj" wx:for-index="midx">
        <view class="member-item" wx:if="{{memberObj.checked1}}">
          <text>{{memberObj.realname}}</text>
          <image src="/imgs/close.png" bindtap="delMember" data-midx="{{memberObj.id}}"></image>
        </view>
      </block>
    </scroll-view>

    <view class="input-wrapper">
      <input name="searchkey" value="{{reg}}" placeholder="请输入检索姓名" bindinput="bindInputReg"></input>
      <view class="image" bindtap="searchName1">
        <image src="/imgs/report/icon_search.png"></image>
      </view>
    </view>

    <view class="depart-wrapper">
      <view class="header">
        <view wx:if="{{stackLen > 1}}" bindtap="bindReturnRegion">
          <image src="/imgs/report/icon_return.png"></image>
          <text>上一级</text>
        </view>
        <view bindtap="bindNavToAddGroup">
          <image src="/imgs/report/icon_plus.png"></image>
          <text>添加分组</text>
        </view>
      </view>
      <scroll-view class="scroll-view-common depart-pannel" scroll-y>
        <!-- <checkbox-group bindchange="bindCheckRegion"> -->
        <checkbox-group>
        <view class="region-item" wx:for="{{stackPeek}}" wx:for-item="regionObj">
          <checkbox value="{{regionObj.value}}" checked="{{regionObj.checked}}" wx:if="{{currentTab==0}}" data-rid="{{regionObj.value}}" bindtap="bindCheckRegion"></checkbox>
          <checkbox value="{{regionObj.value}}" checked="{{regionObj.checked1}}" wx:if="{{currentTab==1}}" data-rid="{{regionObj.value}}" bindtap="bindCheckRegion"></checkbox>
          <text bindtap="bindClickRegion" data-region="{{regionObj}}">{{regionObj.text}}</text>
          <image src="/imgs/register/left.png"></image>
        </view>
        </checkbox-group>
      </scroll-view>
    </view>
  </view>
    
  <view class="btn-wrapper">
    <view data-id="1" bindtap="bindSubmitForm">
      <image src="/imgs/report/select.png"></image>
      <text>提交</text>
    </view>
    <view data-id="0" bindtap="bindSubmitForm">
      <image src="/imgs/report/download.png"></image>
      <text>保存草稿</text>
    </view>
    <view bindtap="bindBackToIndex">
      <image src="/imgs/report/select.png"></image>
      <text>取消</text>
    </view>
  </view>

</view>
</form>

<view class="mask" wx:if="{{showMember}}">
  <view class="member-pannel">
    <view class="title">
      <text>全部成员</text>
      <image src="/imgs/close.png" bindtap="bindHideMask"></image>
    </view>
    <view class="search-pannel">
      <view class="input-pannel">
        <input placeholder="搜索" value="{{reg}}" bindinput="bindInputReg"></input>
        <image src="/imgs/report/icon_search.png" bindtap="searchName1"></image>
      </view>
    </view>
    <scroll-view class="choose-pannel" scroll-y>
      <!-- <checkbox-group bindchange="bindPickMember"> -->
      <checkbox-group>
        <block wx:for="{{departMemberMap}}" wx:for-item="memberList">
          <block wx:for="{{memberList}}" wx:for-item="member">
            <view class="checkbox" wx:if="{{member.inbox && !member.hide}}">
              <checkbox wx:if="{{currentTab==0}}" value="{{member.id}}" checked="{{member.checked}}" data-mid="{{member.id}}" bindtap="bindPickMember1">{{member.realname}}</checkbox>
              <checkbox wx:if="{{currentTab==1}}" value="{{member.id}}" checked="{{member.checked1}}" data-mid="{{member.id}}" bindtap="bindPickMember1">{{member.realname}}</checkbox>
            </view>
          </block>
        </block>
      </checkbox-group>
    </scroll-view>
  </view>
</view>

<view class="picker-mask" catchtouchmove="move" wx:if="{{showPicker}}">
<template is="cascaded-picker-view" data="{{ data: areaPickerData }}" />
</view>